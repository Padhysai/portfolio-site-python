<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Case Study | Admin</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="{{ url_for('static', filename='vendor/quill.snow.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='vendor/quill.js') }}"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        .form-container {
            max-width: 1000px;
            margin: 120px auto 60px;
            padding: 40px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .editor-container {
            margin-bottom: 1.5rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.5rem;
            overflow: hidden;
            /* Ensure toolbar/editor don't overflow rounded corners */
        }

        /* Quill Dark Mode Overrides */
        .ql-toolbar {
            background-color: #1e293b;
            border-color: rgba(255, 255, 255, 0.1) !important;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .ql-container {
            border: none !important;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            color: #f1f5f9;
        }

        .ql-editor.ql-blank::before {
            color: #94a3b8;
            font-style: italic;
        }

        .ql-stroke {
            stroke: #cbd5e1 !important;
        }

        .ql-fill {
            fill: #cbd5e1 !important;
        }

        .ql-picker {
            color: #cbd5e1 !important;
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: var(--gradient);
            border: none;
            border-radius: 8px;
            color: #0f172a;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.1rem;
            transition: 0.3s;
            margin-top: 20px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(56, 189, 248, 0.3);
        }
    </style>
</head>

<body>
    <div class="background-glow"></div>

    <nav class="navbar">
        <div class="container nav-container">
            <a href="{{ url_for('main.index') }}" class="logo">SP<span class="accent">.</span></a>
            <ul class="nav-links">
                <li><a href="{{ url_for('main.index') }}">Home</a></li>
                <li><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('auth.logout') }}" class="btn-primary">Logout</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="section">
            <div class="container">
                <div class="form-container">
                    <h1 class="section-title">{% if case_study %}Edit Case Study{% else %}Create New Case Study{% endif
                        %}</h1>
                    <form method="POST"
                        action="{{ url_for('admin.edit_case_study', id=case_study.id) if case_study else url_for('admin.create_case_study') }}"
                        id="caseStudyForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" id="title" name="title"
                                value="{{ case_study.title if case_study else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="tags">Tags (comma separated)</label>
                            <input type="text" id="tags" name="tags"
                                value="{{ case_study.tags | join(', ') if case_study and case_study.tags else '' }}"
                                placeholder="e.g. Python, Spark, AWS">
                        </div>

                        <div class="form-group">
                            <label for="challenge">Challenge</label>
                            <div class="editor-container">
                                <div id="challenge-editor" style="height: 200px;">{{ case_study.challenge | safe if
                                    case_study and case_study.challenge else '' }}</div>
                            </div>
                            <input type="hidden" name="challenge" id="challenge">
                        </div>

                        <div class="form-group">
                            <label for="solution">Solution</label>
                            <div class="editor-container">
                                <div id="solution-editor" style="height: 200px;">{{ case_study.solution | safe if
                                    case_study
                                    and case_study.solution else '' }}</div>
                            </div>
                            <input type="hidden" name="solution" id="solution">
                        </div>

                        <div class="form-group">
                            <label for="impact">Impact</label>
                            <div class="editor-container">
                                <div id="impact-editor" style="height: 200px;">{{ case_study.impact | safe if case_study
                                    and
                                    case_study.impact else '' }}</div>
                            </div>
                            <input type="hidden" name="impact" id="impact">
                        </div>

                        <div class="form-group">
                            <label for="content">Detailed Content</label>
                            <div class="editor-container">
                                <div id="content-editor" style="height: 400px;">{{ case_study.content | safe if
                                    case_study
                                    and case_study.content else '' }}</div>
                            </div>
                            <input type="hidden" name="content" id="content">
                        </div>

                        <button type="submit" class="btn-submit">{% if case_study %}Update Case Study{% else %}Publish
                            Case Study{% endif %}</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof Quill === 'undefined') {
                console.error('Quill library not loaded');
                alert('Error: Text editor library failed to load. Please refresh the page.');
                return;
            }

            var toolbarOptions = [
                ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
                ['blockquote', 'code-block'],

                [{ 'header': 1 }, { 'header': 2 }],               // custom button values
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'script': 'sub' }, { 'script': 'super' }],      // superscript/subscript
                [{ 'indent': '-1' }, { 'indent': '+1' }],          // outdent/indent
                [{ 'direction': 'rtl' }],                         // text direction

                [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

                [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
                [{ 'font': [] }],
                [{ 'align': [] }],

                ['clean'],                                         // remove formatting
                ['link', 'image']
            ];

            var quillOptions = {
                modules: {
                    toolbar: toolbarOptions
                },
                theme: 'snow'
            };

            var challengeQuill = new Quill('#challenge-editor', quillOptions);
            var solutionQuill = new Quill('#solution-editor', quillOptions);
            var impactQuill = new Quill('#impact-editor', quillOptions);
            var contentQuill = new Quill('#content-editor', quillOptions);

            var form = document.getElementById('caseStudyForm');
            form.onsubmit = function () {
                // Populate hidden inputs with HTML content
                document.getElementById('challenge').value = challengeQuill.root.innerHTML;
                document.getElementById('solution').value = solutionQuill.root.innerHTML;
                document.getElementById('impact').value = impactQuill.root.innerHTML;
                document.getElementById('content').value = contentQuill.root.innerHTML;
            };
        });
    </script>
</body>

</html>